function init(){game.init()&&game.start()}function Drawable(){this.init=function(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s},this.speed=0,this.canvasWidth=0,this.canvasHeight=0,this.collidableWith="",this.isColliding=!1,this.type="",this.draw=function(){},this.move=function(){},this.isCollidableWith=function(t){return this.collidableWith===t.type}}function Background(){this.speed=1,this.draw=function(){this.x-=this.speed,this.context.drawImage(imageRepository.background,this.x-this.canvasWidth,this.y),this.context.drawImage(imageRepository.background,this.x,this.y),this.x<=0&&(this.x=this.canvasWidth)}}function Hero(){this.speed=3,this.bulletPool=new Pool(3);var t=15,e=0;this.collidableWith="enemyBullet",this.type="hero",this.init=function(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.alive=!0,this.isColliding=!1,this.bulletPool.init("bullet")},this.draw=function(){this.context.drawImage(imageRepository.hero,this.x,this.y)},this.move=function(){e++,(KEY_STATUS.left||KEY_STATUS.right||KEY_STATUS.down||KEY_STATUS.up)&&(this.context.clearRect(this.x,this.y,this.width,this.height),KEY_STATUS.left?(this.x-=this.speed,this.x<=0&&(this.x=0)):KEY_STATUS.right?(this.x+=this.speed,this.x>=this.canvasWidth&&(this.x=this.canvasWidth)):KEY_STATUS.up?(this.y-=this.speed,this.y<=0&&(this.y=0)):KEY_STATUS.down&&(this.y+=this.speed,this.y>=this.canvasHeight&&(this.y=this.canvasHeight))),this.isColliding?(this.alive=!1,game.gameOver()):this.draw(),KEY_STATUS.space&&e>=15&&!this.isColliding&&(this.fire(),e=0),KEY_STATUS.space&&e>=15&&!this.isColliding&&(this.fire(),e=0)},this.fire=function(){this.bulletPool.get(this.x,this.y,3),game.laser.get()}}function Enemy(){var t=.01,e=0;this.alive=!1,this.collidableWith="bullet",this.type="enemy",this.spawn=function(t,e,i){this.x=t+this.canvasWidth/1.5,this.y=e+300,this.speed=-i/2,this.speedX=this.speed,this.speedY=0,this.alive=!0,this.leftEdge=this.x-130,this.topEdge=this.y-40,this.bottomEdge=this.y+40},this.draw=function(){return this.context.clearRect(this.x-1,this.y,this.width+1,this.height),this.x+=this.speedX,this.y+=this.speedY,0!=this.speedX&&this.x<=this.leftEdge?(this.speedX=0,this.speedY=this.speed):this.speedY<0&&this.y<=this.topEdge?this.speedY=-this.speed:this.speedY>0&&this.y>=this.bottomEdge&&(this.speedY=this.speed),this.isColliding?(game.playerScore+=10,game.explosion.get(),!0):(this.context.drawImage(imageRepository.enemy,this.x,this.y),e=Math.floor(101*Math.random()),e/100<.01&&this.fire(),!1)},this.fire=function(){game.enemyBulletPool.get(this.x+this.width/2,this.y+this.height,-2.5)},this.clear=function(){this.x=0,this.y=0,this.speed=0,this.speedX=0,this.speedY=0,this.alive=!1,this.isColliding=!1}}function Game(){this.init=function(){if(this.bgCanvas=document.getElementById("background"),this.heroCanvas=document.getElementById("hero"),this.mainCanvas=document.getElementById("main"),this.bgCanvas.getContext){this.bgContext=this.bgCanvas.getContext("2d"),this.heroContext=this.heroCanvas.getContext("2d"),this.mainContext=this.mainCanvas.getContext("2d"),Background.prototype.context=this.bgContext,Background.prototype.canvasWidth=this.bgCanvas.width,Background.prototype.canvasHeight=this.bgCanvas.height,Hero.prototype.context=this.heroContext,Hero.prototype.canvasWidth=this.heroCanvas.width,Hero.prototype.canvasHeight=this.heroCanvas.height,Bullet.prototype.context=this.mainContext,Bullet.prototype.canvasWidth=this.mainCanvas.width,Bullet.prototype.canvasHeight=this.mainCanvas.height,Enemy.prototype.context=this.mainContext,Enemy.prototype.canvasWidth=this.mainCanvas.width,Enemy.prototype.canvasHeight=this.mainCanvas.height,this.background=new Background,this.background.init(0,0),this.hero=new Hero;var t=this.heroCanvas.height/2-imageRepository.hero.height,e=this.heroCanvas.width/10-2*imageRepository.hero.width;this.hero.init(e,t,imageRepository.hero.width,imageRepository.hero.height),this.enemyPool=new Pool(9),this.enemyPool.init("enemy"),this.spawnWave(),this.enemyBulletPool=new Pool(9),this.enemyBulletPool.init("enemyBullet"),this.quadTree=new QuadTree({x:0,y:0,width:this.mainCanvas.width,height:this.mainCanvas.height}),this.playerScore=0,this.laser=new SoundPool(10),this.laser.init("laser"),this.explosion=new SoundPool(20),this.explosion.init("explosion"),this.backgroundAudio=new Audio("sounds/kick_shock.wav"),this.backgroundAudio.loop=!0,this.backgroundAudio.volume=.2,this.backgroundAudio.load(),this.gameOverAudio=new Audio("sounds/game_over.mp3"),this.gameOverAudio.loop=!0,this.gameOverAudio.volume=1,this.gameOverAudio.load(),this.checkAudio=window.setInterval(function(){checkReadyState()},1e3)}},this.spawnWave=function(){for(var t=imageRepository.enemy.height,e=imageRepository.enemy.width,i=100,s=-t,h=1.5*s,o=1;o<=9;o++)this.enemyPool.get(i,s,2),i+=e+25,o%3==0&&(i=100,s+=h)},this.start=function(){this.hero.draw(),this.backgroundAudio.play(),animate()},this.restart=function(){this.gameOverAudio.pause(),document.getElementById("game-over").style.display="none",this.bgContext.clearRect(0,0,this.bgCanvas.width,this.bgCanvas.height),this.heroContext.clearRect(0,0,this.heroCanvas.width,this.heroCanvas.height),this.mainContext.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.quadTree.clear(),this.background.init(0,0);var t=this.heroCanvas.height/2-imageRepository.hero.height,e=this.heroCanvas.width/10-2*imageRepository.hero.width;this.hero.init(e,t,imageRepository.hero.width,imageRepository.hero.height),this.enemyPool.init("enemy"),this.spawnWave(),this.enemyBulletPool.init("enemyBullet"),this.playerScore=0,this.backgroundAudio.currentTime=0,this.backgroundAudio.play(),this.start()},this.gameOver=function(){this.backgroundAudio.pause(),this.gameOverAudio.currentTime=0,this.gameOverAudio.play(),document.getElementById("game-over").style.display="block"},this.mute=function(){0!=this.backgroundAudio.volume?(this.backgroundAudio.volume=0,this.gameOverAudio.volume=0):(this.backgroundAudio.volume=1,this.gameOverAudio.volume=1)}}function animate(){document.getElementById("score").innerHTML=game.playerScore,game.quadTree.clear(),game.quadTree.insert(game.hero),game.quadTree.insert(game.hero.bulletPool.getPool()),game.quadTree.insert(game.enemyPool.getPool()),game.quadTree.insert(game.enemyBulletPool.getPool()),detectCollision(),0===game.enemyPool.getPool().length&&game.spawnWave(),game.hero.alive&&(requestAnimFrame(animate),game.background.draw(),game.hero.move(),game.hero.bulletPool.animate(),game.enemyPool.animate(),game.enemyBulletPool.animate())}var game=new Game,imageRepository=new function(){function t(){++i===e&&window.init()}this.background=new Image,this.hero=new Image,this.bullet=new Image,this.enemy=new Image,this.enemyBullet=new Image;var e=5,i=0;this.background.onload=function(){t()},this.hero.onload=function(){t()},this.bullet.onload=function(){t()},this.enemy.onload=function(){t()},this.enemyBullet.onload=function(){t()},this.background.src="imgs/bg.png",this.hero.src="imgs/hero.png",this.bullet.src="imgs/bullet.png",this.enemy.src="imgs/enemy.png",this.enemyBullet.src="imgs/bullet_enemy.png"};Background.prototype=new Drawable,Hero.prototype=new Drawable,Enemy.prototype=new Drawable;